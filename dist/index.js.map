{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { useState } from \"react\";\n\ntype T = Record<string, any> | undefined;\n\nfunction useContext() {\n  const [workspace, setWorkspace] = useState<T>(undefined);\n  const [property, setProperty] = useState<T>(undefined);\n  const [boundary, setBoundary] = useState<T>(undefined);\n  const [task, setTask] = useState<T>(undefined);\n  const [record, setRecord] = useState<T>(undefined);\n\n  const [requested, setRequested] = useState(false);\n\n  window.addEventListener(\"message\", (event) => {\n    if (event.data.type === \"sensand:res:context\") {\n      console.log(\"CHILD:\", event.data.type);\n\n      setWorkspace(event.data.workspace);\n      setProperty(event.data.property);\n      setBoundary(event.data.boundary);\n      setTask(event.data.task);\n      setRecord(event.data.record);\n    }\n  });\n\n  if (!requested) {\n    window.parent.postMessage({ type: \"sensand:req:context\" }, \"*\");\n    setRequested(true);\n  }\n\n  return {\n    workspace,\n    property,\n    boundary,\n    task,\n    record,\n  };\n}\n\nasync function ping() {\n  await new Promise<void>((resolve) => {\n    const handler = (event: MessageEvent) => {\n      if (event.data.type === \"sensand:res:ping\") {\n        console.log(\"CHILD:\", event.data.type);\n        console.log(\"Pong!\");\n        resolve();\n      }\n    };\n\n    window.addEventListener(\"message\", handler, { once: true });\n\n    window.parent.postMessage({ type: \"sensand:req:ping\" }, \"*\");\n  });\n}\n\nasync function flyTo(lat: number, lon: number) {\n  await new Promise<void>((resolve) => {\n    const handler = (event: MessageEvent) => {\n      if (event.data.type === \"sensand:res:flyTo\") {\n        console.log(\"CHILD:\", event.data.type);\n        console.log(\"Flying to\", lat, lon);\n        resolve();\n      }\n    };\n\n    window.addEventListener(\"message\", handler, { once: true });\n\n    window.parent.postMessage({ type: \"sensand:req:flyTo\", lat, lon }, \"*\");\n  });\n}\n\nasync function setZoom(zoom: number) {\n  await new Promise<void>((resolve) => {\n    const handler = (event: MessageEvent) => {\n      if (event.data.type === \"sensand:res:setZoom\") {\n        console.log(\"CHILD:\", event.data.type);\n        console.log(\"Zooming to\", zoom);\n        resolve();\n      }\n    };\n\n    window.addEventListener(\"message\", handler, { once: true });\n\n    window.parent.postMessage({ type: \"sensand:req:setZoom\", zoom }, \"*\");\n  });\n}\n\nexport const sensand = {\n  useContext,\n  ping,\n  flyTo,\n  setZoom,\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAyB;AAIzB,SAAS,aAAa;AACpB,QAAM,CAAC,WAAW,YAAY,QAAI,uBAAY,MAAS;AACvD,QAAM,CAAC,UAAU,WAAW,QAAI,uBAAY,MAAS;AACrD,QAAM,CAAC,UAAU,WAAW,QAAI,uBAAY,MAAS;AACrD,QAAM,CAAC,MAAM,OAAO,QAAI,uBAAY,MAAS;AAC7C,QAAM,CAAC,QAAQ,SAAS,QAAI,uBAAY,MAAS;AAEjD,QAAM,CAAC,WAAW,YAAY,QAAI,uBAAS,KAAK;AAEhD,SAAO,iBAAiB,WAAW,CAAC,UAAU;AAC5C,QAAI,MAAM,KAAK,SAAS,uBAAuB;AAC7C,cAAQ,IAAI,UAAU,MAAM,KAAK,IAAI;AAErC,mBAAa,MAAM,KAAK,SAAS;AACjC,kBAAY,MAAM,KAAK,QAAQ;AAC/B,kBAAY,MAAM,KAAK,QAAQ;AAC/B,cAAQ,MAAM,KAAK,IAAI;AACvB,gBAAU,MAAM,KAAK,MAAM;AAAA,IAC7B;AAAA,EACF,CAAC;AAED,MAAI,CAAC,WAAW;AACd,WAAO,OAAO,YAAY,EAAE,MAAM,sBAAsB,GAAG,GAAG;AAC9D,iBAAa,IAAI;AAAA,EACnB;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAEA,eAAe,OAAO;AACpB,QAAM,IAAI,QAAc,CAAC,YAAY;AACnC,UAAM,UAAU,CAAC,UAAwB;AACvC,UAAI,MAAM,KAAK,SAAS,oBAAoB;AAC1C,gBAAQ,IAAI,UAAU,MAAM,KAAK,IAAI;AACrC,gBAAQ,IAAI,OAAO;AACnB,gBAAQ;AAAA,MACV;AAAA,IACF;AAEA,WAAO,iBAAiB,WAAW,SAAS,EAAE,MAAM,KAAK,CAAC;AAE1D,WAAO,OAAO,YAAY,EAAE,MAAM,mBAAmB,GAAG,GAAG;AAAA,EAC7D,CAAC;AACH;AAEA,eAAe,MAAM,KAAa,KAAa;AAC7C,QAAM,IAAI,QAAc,CAAC,YAAY;AACnC,UAAM,UAAU,CAAC,UAAwB;AACvC,UAAI,MAAM,KAAK,SAAS,qBAAqB;AAC3C,gBAAQ,IAAI,UAAU,MAAM,KAAK,IAAI;AACrC,gBAAQ,IAAI,aAAa,KAAK,GAAG;AACjC,gBAAQ;AAAA,MACV;AAAA,IACF;AAEA,WAAO,iBAAiB,WAAW,SAAS,EAAE,MAAM,KAAK,CAAC;AAE1D,WAAO,OAAO,YAAY,EAAE,MAAM,qBAAqB,KAAK,IAAI,GAAG,GAAG;AAAA,EACxE,CAAC;AACH;AAEA,eAAe,QAAQ,MAAc;AACnC,QAAM,IAAI,QAAc,CAAC,YAAY;AACnC,UAAM,UAAU,CAAC,UAAwB;AACvC,UAAI,MAAM,KAAK,SAAS,uBAAuB;AAC7C,gBAAQ,IAAI,UAAU,MAAM,KAAK,IAAI;AACrC,gBAAQ,IAAI,cAAc,IAAI;AAC9B,gBAAQ;AAAA,MACV;AAAA,IACF;AAEA,WAAO,iBAAiB,WAAW,SAAS,EAAE,MAAM,KAAK,CAAC;AAE1D,WAAO,OAAO,YAAY,EAAE,MAAM,uBAAuB,KAAK,GAAG,GAAG;AAAA,EACtE,CAAC;AACH;AAEO,IAAM,UAAU;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;","names":[]}